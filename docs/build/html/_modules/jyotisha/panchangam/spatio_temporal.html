
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>jyotisha.panchangam.spatio_temporal &#8212; jyotisha 0.0.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jyotisha.panchangam.spatio_temporal</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1">#  -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">swisseph</span> <span class="k">as</span> <span class="nn">swe</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">floor</span>

<span class="kn">from</span> <span class="nn">indic_transliteration</span> <span class="k">import</span> <span class="n">sanscript</span>
<span class="kn">from</span> <span class="nn">pytz</span> <span class="k">import</span> <span class="n">timezone</span> <span class="k">as</span> <span class="n">tz</span>
<span class="kn">from</span> <span class="nn">sanskrit_data.schema</span> <span class="k">import</span> <span class="n">common</span>
<span class="kn">from</span> <span class="nn">sanskrit_data.schema.common</span> <span class="k">import</span> <span class="n">JsonObject</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">brentq</span>

<span class="kn">import</span> <span class="nn">jyotisha.custom_transliteration</span>
<span class="kn">import</span> <span class="nn">jyotisha.panchangam</span>
<span class="kn">import</span> <span class="nn">jyotisha.panchangam.temporal</span>
<span class="kn">from</span> <span class="nn">jyotisha.custom_transliteration</span> <span class="k">import</span> <span class="n">sexastr2deci</span>
<span class="kn">from</span> <span class="nn">jyotisha.panchangam.temporal</span> <span class="k">import</span> <span class="n">get_angam_float</span><span class="p">,</span> <span class="n">get_angam</span><span class="p">,</span> <span class="n">SOLAR_MONTH</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
  <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
  <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(asctime)s</span><span class="s2"> {</span><span class="si">%(filename)s</span><span class="s2">:</span><span class="si">%(lineno)d</span><span class="s2">}: </span><span class="si">%(message)s</span><span class="s2"> &quot;</span>
<span class="p">)</span>

<span class="n">CODE_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<span class="c1"># next new/full moon from current one is at least 27.3 days away</span>


<div class="viewcode-block" id="City"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.City">[docs]</a><span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">JsonObject</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;This class enables the construction of a city object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">timezone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for city&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latstr</span> <span class="o">=</span> <span class="n">latitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lonstr</span> <span class="o">=</span> <span class="n">longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">sexastr2deci</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">sexastr2deci</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">timezone</span></div>


<div class="viewcode-block" id="get_lagna_float"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.get_lagna_float">[docs]</a><span class="k">def</span> <span class="nf">get_lagna_float</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SIDM_LAHIRI</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the angam</span>

<span class="sd">      Args:</span>
<span class="sd">        float jd: The Julian Day at which the lagnam is to be computed</span>
<span class="sd">        lat: Latitude of the place where the lagnam is to be computed</span>
<span class="sd">        lon: Longitude of the place where the lagnam is to be computed</span>
<span class="sd">        offset: Used by internal functions for bracketing</span>

<span class="sd">      Returns:</span>
<span class="sd">        float lagna</span>

<span class="sd">      Examples:</span>
<span class="sd">        &gt;&gt;&gt; get_lagna_float(2444961.7125,13.08784, 80.27847)</span>
<span class="sd">        10.353595502472984</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">swe</span><span class="o">.</span><span class="n">set_sid_mode</span><span class="p">(</span><span class="n">ayanamsha_id</span><span class="p">)</span>
    <span class="n">lcalc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_ut</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span>
    <span class="n">lcalc</span> <span class="o">=</span> <span class="n">lcalc</span> <span class="o">%</span> <span class="mi">360</span>

    <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;offset:&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lcalc/30&#39;</span><span class="p">,</span> <span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lcalc/30 + offset = &#39;</span><span class="p">,</span> <span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>

        <span class="c1"># The max expected value is somewhere between 2 and -2, with bracketing</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">-</span> <span class="mi">12</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">lcalc</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span></div>


<div class="viewcode-block" id="get_lagna_data"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.get_lagna_data">[docs]</a><span class="k">def</span> <span class="nf">get_lagna_data</span><span class="p">(</span><span class="n">jd_sunrise</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tz_off</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SIDM_LAHIRI</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the lagna data</span>

<span class="sd">      Args:</span>
<span class="sd">        float jd: The Julian Day at which the lagnam is to be computed</span>
<span class="sd">        lat: Latitude of the place where the lagnam is to be computed</span>
<span class="sd">        lon: Longitude of the place where the lagnam is to be computed</span>
<span class="sd">        offset: Used by internal functions for bracketing</span>

<span class="sd">      Returns:</span>
<span class="sd">        tuples detailing the end time of each lagna, beginning with the one</span>
<span class="sd">        prevailing at sunrise</span>

<span class="sd">      Examples:</span>
<span class="sd">        &gt;&gt;&gt; get_lagna_data(2458222.5208333335, lat=13.08784, lon=80.27847, tz_off=5.5)</span>
<span class="sd">        [(12, 2458222.5214310056), (1, 2458222.596420153), (2, 2458222.6812926503), (3, 2458222.772619788), (4, 2458222.8624254186), (5, 2458222.9478168003), (6, 2458223.0322211445), (7, 2458223.1202004547), (8, 2458223.211770839), (9, 2458223.3000455885), (10, 2458223.3787625884), (11, 2458223.4494649624)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lagna_sunrise</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">get_lagna_float</span><span class="p">(</span><span class="n">jd_sunrise</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">ayanamsha_id</span><span class="p">))</span>

    <span class="n">lagna_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="n">lagna_sunrise</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>

    <span class="n">lbrack</span> <span class="o">=</span> <span class="n">jd_sunrise</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">24</span>
    <span class="n">rbrack</span> <span class="o">=</span> <span class="n">jd_sunrise</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">24</span>
    <span class="n">lagna_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">lagna</span> <span class="ow">in</span> <span class="n">lagna_list</span><span class="p">:</span>
        <span class="c1"># print(&#39;---\n&#39;, lagna)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lagna sunrise&#39;</span><span class="p">,</span> <span class="n">get_lagna_float</span><span class="p">(</span><span class="n">jd_sunrise</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">ayanamsha_id</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lbrack&#39;</span><span class="p">,</span> <span class="n">get_lagna_float</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="o">-</span><span class="n">lagna</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">ayanamsha_id</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rbrack&#39;</span><span class="p">,</span> <span class="n">get_lagna_float</span><span class="p">(</span><span class="n">rbrack</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="o">-</span><span class="n">lagna</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">ayanamsha_id</span><span class="p">))</span>

        <span class="n">lagna_end_time</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">get_lagna_float</span><span class="p">,</span> <span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="o">-</span><span class="n">lagna</span><span class="p">,</span> <span class="n">debug</span><span class="p">))</span>
        <span class="n">lbrack</span> <span class="o">=</span> <span class="n">lagna_end_time</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span>
        <span class="n">rbrack</span> <span class="o">=</span> <span class="n">lagna_end_time</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">24</span>
        <span class="n">lagna_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lagna</span><span class="p">,</span> <span class="n">lagna_end_time</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lagna_data</span></div>


<div class="viewcode-block" id="get_solar_month_day"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.get_solar_month_day">[docs]</a><span class="k">def</span> <span class="nf">get_solar_month_day</span><span class="p">(</span><span class="n">jd_start</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SIDM_LAHIRI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the solar month and day for a given Julian day</span>

<span class="sd">    Computes the solar month and day on the day corresponding to a given</span>
<span class="sd">    Julian day</span>

<span class="sd">    Args:</span>
<span class="sd">      float jd</span>
<span class="sd">      city</span>

<span class="sd">    Returns:</span>
<span class="sd">      int solar_month</span>
<span class="sd">      int solar_month_day</span>

<span class="sd">    Examples:</span>
<span class="sd">      &gt;&gt;&gt; get_solar_month_day(2457023.27, city(&#39;Chennai&#39;, &#39;13:05:24&#39;, \</span>
<span class="sd">&#39;80:16:12&#39;, &#39;Asia/Calcutta&#39;))</span>
<span class="sd">      (9, 17)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">jd_sunset</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span><span class="n">jd_start</span><span class="o">=</span><span class="n">jd_start</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                               <span class="n">lat</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_SET</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">solar_month</span> <span class="o">=</span> <span class="n">get_angam</span><span class="p">(</span><span class="n">jd_sunset</span><span class="p">,</span> <span class="n">SOLAR_MONTH</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">ayanamsha_id</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">solar_month</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">jd_masa_transit</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">get_angam_float</span><span class="p">,</span> <span class="n">jd_start</span> <span class="o">-</span> <span class="mi">34</span><span class="p">,</span> <span class="n">jd_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">SOLAR_MONTH</span><span class="p">,</span> <span class="o">-</span><span class="n">target</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="n">jd_next_sunset</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span><span class="n">jd_start</span><span class="o">=</span><span class="n">jd_masa_transit</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">,</span>
                                    <span class="n">lon</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                    <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_SET</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">jd_next_sunrise</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span><span class="n">jd_start</span><span class="o">=</span><span class="n">jd_masa_transit</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">,</span>
                                     <span class="n">lon</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                     <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_RISE</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">jd_next_sunset</span> <span class="o">&gt;</span> <span class="n">jd_next_sunrise</span><span class="p">:</span>
        <span class="c1"># Masa begins after sunset and before sunrise</span>
        <span class="c1"># Therefore Masa 1 is on the day when the sun rises next</span>
        <span class="n">solar_month_day</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_next_sunrise</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Masa has started before sunset</span>
        <span class="n">solar_month_day</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_next_sunset</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">solar_month</span><span class="p">,</span> <span class="n">solar_month_day</span><span class="p">)</span></div>


<div class="viewcode-block" id="Panchangam"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam">[docs]</a><span class="k">class</span> <span class="nc">Panchangam</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">JsonObject</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;This class enables the construction of a panchangam</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="n">sanscript</span><span class="o">.</span><span class="n">DEVANAGARI</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;hh:mm&#39;</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SIDM_LAHIRI</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the panchangam.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">julday</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># - tz_off/24.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weekday_start</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">day_of_week</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">julday</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># swe has Mon = 0, non-intuitively!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="o">=</span><span class="n">ayanamsha_id</span>
        <span class="n">swe</span><span class="o">.</span><span class="n">set_sid_mode</span><span class="p">(</span><span class="n">ayanamsha_id</span><span class="p">)</span>

<div class="viewcode-block" id="Panchangam.computeAngams"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.computeAngams">[docs]</a>    <span class="k">def</span> <span class="nf">computeAngams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute_lagnams</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the entire panchangam</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># INITIALISE VARIABLES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jd_moonset</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>

        <span class="n">solar_month_sunrise</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">month_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tithi_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yogam_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">karanam_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rashi_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagna_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalams</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span><span class="p">)]</span>

        <span class="c1"># Computing solar month details for Dec 31</span>
        <span class="c1"># rather than Jan 1, since we have an always increment</span>
        <span class="c1"># solar_month_day at the start of the loop across every day in</span>
        <span class="c1"># year</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">solar_month_day</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_solar_month_day</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Dec 31 does not appear to be Dhanurmasa!&#39;</span><span class="p">))</span>

        <span class="n">month_start_after_sunset</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#############################################################</span>
        <span class="c1"># Compute all parameters -- sun/moon latitude/longitude etc #</span>
        <span class="c1">#############################################################</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weekday_start</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_DAYS_PER_YEAR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># checking @ 6am local - can we do any better?</span>
            <span class="n">local_time</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c1"># compute offset from UTC in hours</span>
            <span class="n">tz_off</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span>
                      <span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span>

            <span class="c1"># What is the jd at 00:00 local time today?</span>
            <span class="n">jd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">-</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span>
                <span class="n">jd_start</span><span class="o">=</span><span class="n">jd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">,</span>
                <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_RISE</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span>
                <span class="n">jd_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">,</span>
                <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_SET</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span>
                <span class="n">jd_start</span><span class="o">=</span><span class="n">jd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_RISE</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jd_moonset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span>
                <span class="n">jd_start</span><span class="o">=</span><span class="n">jd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">,</span>
                <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_SET</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">longitude_sun_sunrise</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">longitude_sun_sunset</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">((</span><span class="n">longitude_sun_sunset</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">))</span>

            <span class="n">solar_month_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(((</span><span class="n">longitude_sun_sunrise</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">))</span>

            <span class="k">if</span><span class="p">(</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">continue</span>
                <span class="c1"># This is just to initialise, since for a lot of calculations,</span>
                <span class="c1"># we require comparing with tomorrow&#39;s data. This computes the</span>
                <span class="c1"># data for day 0, -1.</span>

            <span class="c1"># Solar month calculations</span>
            <span class="n">solar_month_end_time</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">month_start_after_sunset</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">solar_month_day</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">month_start_after_sunset</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">solar_month_day</span> <span class="o">=</span> <span class="n">solar_month_day</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">!=</span> <span class="n">solar_month_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">month_start_after_sunset</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="p">[</span><span class="n">_m</span><span class="p">,</span> <span class="n">solar_month_end_jd</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">SOLAR_MONTH</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">solar_month_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]:</span>
                <span class="c1"># sankrAnti!</span>
                <span class="c1"># sun moves into next rAshi before sunset</span>
                <span class="n">solar_month_day</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="p">[</span><span class="n">_m</span><span class="p">,</span> <span class="n">solar_month_end_jd</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">SOLAR_MONTH</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solar_month_day</span> <span class="o">=</span> <span class="n">solar_month_day</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">solar_month_end_jd</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># if self.solar_month[d-1] != self.solar_month[d]:</span>
            <span class="c1">#     # We have a sUrya sankrAnti between yest. and today&#39;s sunsets</span>
            <span class="c1">#     solar_month_day = 1</span>
            <span class="c1">#     if solar_month_sunrise[d] == self.solar_month[d]:</span>
            <span class="c1">#         #the sankrAnti happened before today&#39;s sunrise</span>
            <span class="c1">#         #so search for the end time between yesterday and</span>
            <span class="c1">#         #today&#39;s sunrises</span>
            <span class="c1">#         [_m, solar_month_end_jd] = helper_functions.get_angam_data(self.jd_sunrise[d-1],</span>
            <span class="c1">#             self.jd_sunrise[d],SOLAR_MONTH)[0]</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         #the sankrAnti happens after today&#39;s sunrise</span>
            <span class="c1">#         #so search for the end time between today and</span>
            <span class="c1">#         #tomorrow&#39;s sunrises</span>
            <span class="c1">#         [_m, solar_month_end_jd] = helper_functions.get_angam_data(self.jd_sunrise[d],</span>
            <span class="c1">#             self.jd_sunrise[d + 1],SOLAR_MONTH)[0]</span>
            <span class="c1">#     #print (&#39;-----&#39;,revjul(jd = solar_month_end_jd, tz_off = tz_off))</span>
            <span class="c1"># else:</span>
            <span class="c1">#     solar_month_day += 1</span>
            <span class="c1">#     solar_month_end_jd = None</span>

            <span class="k">if</span> <span class="n">solar_month_end_jd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">solar_month_end_time</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solar_month_end_time</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">mbox{</span><span class="si">%s</span><span class="s1"> {</span><span class="se">\\</span><span class="s1">tiny </span><span class="se">\\</span><span class="s1">RIGHTarrow} </span><span class="se">\\</span><span class="s1">textsf{</span><span class="si">%s</span><span class="s1">}}&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">[</span><span class="s1">&#39;MASA&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">][</span><span class="n">_m</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span>
                        <span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="n">solar_month_end_jd</span> <span class="o">-</span> <span class="n">jd</span><span class="p">))</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">month_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">sunmonth{</span><span class="si">%s</span><span class="s1">}{</span><span class="si">%d</span><span class="s1">}{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">[</span><span class="s1">&#39;MASA&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]],</span>
                <span class="n">solar_month_day</span><span class="p">,</span> <span class="n">solar_month_end_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar_month_day</span>

            <span class="c1"># KARADAYAN NOMBU -- easy to check here</span>
            <span class="k">if</span> <span class="n">solar_month_end_jd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># month ends today</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">solar_month_day</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>\
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">and</span> <span class="n">solar_month_day</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kAraDaiyAn2 nOmbu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="c1"># Compute the various kalas</span>
            <span class="c1"># Sunrise/sunset and related stuff (like rahu, yama)</span>
            <span class="n">YAMAGANDA_OCTETS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
            <span class="n">RAHUKALA_OCTETS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">GULIKAKALA_OCTETS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kalams</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;prAtaH sandhyA&#39;</span><span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                <span class="s1">&#39;prAtah&#39;</span>        <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;saGgava&#39;</span>       <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;madhyAhna&#39;</span>     <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;aparAhna&#39;</span>      <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;sAyAhna&#39;</span>       <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;sAyaM sandhyA&#39;</span> <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                <span class="s1">&#39;rahu&#39;</span>          <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">RAHUKALA_OCTETS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]],</span> <span class="mi">8</span><span class="p">),</span>
                <span class="s1">&#39;yama&#39;</span>          <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">YAMAGANDA_OCTETS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]],</span> <span class="mi">8</span><span class="p">),</span>
                <span class="s1">&#39;gulika&#39;</span>        <span class="p">:</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_kalas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">GULIKAKALA_OCTETS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]],</span> <span class="mi">8</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="c1"># Compute all the anga datas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tithi_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                                             <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_data</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                                                  <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_data</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yogam_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                                             <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">YOGAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">karanam_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                                               <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">KARANAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rashi_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                                             <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">RASHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">compute_lagnams</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lagna_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_lagna_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">tz_off</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Panchangam.assignLunarMonths"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.assignLunarMonths">[docs]</a>    <span class="k">def</span> <span class="nf">assignLunarMonths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">last_d_assigned</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_new_moon_start</span><span class="p">,</span> <span class="n">last_new_moon_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">-</span>
                                                                                             <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
                                                                                             <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">-</span>
                                                                                             <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                                                                             <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
        <span class="n">prev_new_moon_start</span><span class="p">,</span> <span class="n">prev_new_moon_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span><span class="n">last_new_moon_start</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span>
                                                                                             <span class="n">last_new_moon_start</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span>
                                                                                             <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
        <span class="c1"># Check if current mAsa is adhika here</span>
        <span class="n">isAdhika</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_solar_rashi</span><span class="p">(</span><span class="n">last_new_moon_start</span><span class="p">)</span> <span class="o">==</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_solar_rashi</span><span class="p">(</span><span class="n">prev_new_moon_start</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">last_new_moon_start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">+</span> <span class="mi">367</span><span class="p">:</span>
            <span class="n">this_new_moon_start</span><span class="p">,</span> <span class="n">this_new_moon_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span><span class="n">last_new_moon_start</span> <span class="o">+</span> <span class="mi">24</span><span class="p">,</span>
                                                                                                 <span class="n">last_new_moon_start</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span>
                                                                                                 <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_d_assigned</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last_d_assigned</span> <span class="o">+</span> <span class="mi">32</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">367</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">this_new_moon_end</span><span class="p">:</span>
                    <span class="n">last_d_assigned</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">isAdhika</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">last_d_assigned</span><span class="p">]</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">last_d_assigned</span><span class="p">]</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">isAdhika</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_solar_rashi</span><span class="p">(</span><span class="n">this_new_moon_start</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_solar_rashi</span><span class="p">(</span><span class="n">last_new_moon_start</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
            <span class="n">last_new_moon_start</span> <span class="o">=</span> <span class="n">this_new_moon_start</span></div>

        <span class="c1"># # Older code below. Major mistake was that calculation was done after checking for</span>
        <span class="c1"># # prathama, rather than for amavasya.</span>
        <span class="c1"># last_month_change = 1</span>
        <span class="c1"># last_lunar_month = None</span>

        <span class="c1"># for d in range(1, helper_functions.MAX_SZ - 1):</span>
        <span class="c1">#     # Assign lunar_month for each day</span>
        <span class="c1">#     if self.tithi_sunrise[d] == 1 and self.tithi_sunrise[d - 1] != 1:</span>
        <span class="c1">#         for i in range(last_month_change, d):</span>
        <span class="c1">#             if (self.solar_month[d] == last_lunar_month):</span>
        <span class="c1">#                 self.lunar_month[i] = self.solar_month[d] % 12 + 0.5</span>
        <span class="c1">#             else:</span>
        <span class="c1">#                 self.lunar_month[i] = self.solar_month[d]</span>
        <span class="c1">#         last_month_change = d</span>
        <span class="c1">#         last_lunar_month = self.solar_month[d]</span>
        <span class="c1">#     elif self.tithi_sunrise[d] == 2 and self.tithi_sunrise[d - 1] == 30:</span>
        <span class="c1">#         # prathama tithi was never seen @ sunrise</span>
        <span class="c1">#         for i in range(last_month_change, d):</span>
        <span class="c1">#             if (self.solar_month[d - 1] == last_lunar_month):</span>
        <span class="c1">#                 self.lunar_month[i] = self.solar_month[d - 1] % 12 + 0.5</span>
        <span class="c1">#             else:</span>
        <span class="c1">#                 self.lunar_month[i] = self.solar_month[d - 1]</span>
        <span class="c1">#         last_month_change = d</span>
        <span class="c1">#         last_lunar_month = self.solar_month[d - 1]</span>

        <span class="c1"># for i in range(last_month_change, helper_functions.MAX_SZ - 1):</span>
        <span class="c1">#     self.lunar_month[i] = self.solar_month[last_month_change - 1] + 1</span>

<div class="viewcode-block" id="Panchangam.get_angams_for_kalas"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.get_angams_for_kalas">[docs]</a>    <span class="k">def</span> <span class="nf">get_angams_for_kalas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">get_angam_func</span><span class="p">,</span> <span class="n">kala_type</span><span class="p">):</span>
        <span class="n">jd_sunrise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="n">jd_sunrise_tmrw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">jd_sunrise_datmrw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">jd_sunset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="n">jd_sunset_tmrw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">jd_moonrise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="n">jd_moonrise_tmrw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;sunrise&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span> <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span> <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;sunset&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span> <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span> <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;pratah&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>  <span class="c1"># pratah1 start</span>
                      <span class="c1"># pratah1 end</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>  <span class="c1"># pratah2 start</span>
                      <span class="c1"># pratah2 end</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>\
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;sangava&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;madhyahna&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span>
                                                        <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;aparahna&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;sayahna&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunset</span> <span class="o">-</span> <span class="n">jd_sunrise</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">-</span> <span class="n">jd_sunrise_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;madhyaratri&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;pradosha&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;nishita&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">7.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">7.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;ratrimana&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">15.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">15.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;arunodaya&#39;</span><span class="p">:</span>  <span class="c1"># deliberately not simplifying expressions involving 15/15</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">13.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset</span> <span class="o">+</span> <span class="p">(</span><span class="n">jd_sunrise_tmrw</span> <span class="o">-</span> <span class="n">jd_sunset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">15.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">13.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_sunset_tmrw</span> <span class="o">+</span>
                                     <span class="p">(</span><span class="n">jd_sunrise_datmrw</span> <span class="o">-</span> <span class="n">jd_sunset_tmrw</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">15.0</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">kala_type</span> <span class="o">==</span> <span class="s1">&#39;moonrise&#39;</span><span class="p">:</span>
            <span class="n">angams</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_moonrise</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span> <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_moonrise</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                      <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_moonrise_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span> <span class="n">get_angam_func</span><span class="p">(</span><span class="n">jd_moonrise_tmrw</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Error!</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s1">&#39;Unkown kala &quot;</span><span class="si">%s</span><span class="s1">&quot; input!&#39;</span> <span class="o">%</span> <span class="n">kala_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">angams</span></div>

<div class="viewcode-block" id="Panchangam.addFestival"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.addFestival">[docs]</a>    <span class="k">def</span> <span class="nf">addFestival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">festival_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                <span class="c1"># Second occurrence of a festival within a</span>
                <span class="c1"># Gregorian calendar year</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span></div>

<div class="viewcode-block" id="Panchangam.computeFestivals"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.computeFestivals">[docs]</a>    <span class="k">def</span> <span class="nf">computeFestivals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># debugFestivals = True</span>
        <span class="n">debugFestivals</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_DAYS_PER_YEAR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># checking @ 6am local - can we do any better?</span>
            <span class="n">local_time</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c1"># compute offset from UTC in hours</span>
            <span class="n">tz_off</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span>
                      <span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span>

            <span class="c1"># What is the jd at 00:00 local time today?</span>
            <span class="c1"># jd = self.jd_start - (tz_off / 24.0) + d - 1</span>

            <span class="c1">####################</span>
            <span class="c1"># Festival details #</span>
            <span class="c1">####################</span>

            <span class="c1"># --- MONTHLY VRATAMS --- #</span>

            <span class="c1"># EKADASHI Vratam</span>
            <span class="c1"># One of two consecutive tithis must appear @ sunrise!</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="c1"># check for shukla ekadashi</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;sarva-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;shukla&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sarva-vaikuNTha-EkAdazI&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sarva-guruvAyupura-EkAdazI&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">11</span><span class="p">):</span>
                    <span class="c1"># Check dashami end time to decide for whether this is</span>
                    <span class="c1"># sarva/smartha</span>
                    <span class="c1"># Two muhurtams is 1/15 of day-length</span>
                    <span class="n">tithi_arunodayam</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tithi_arunodayam</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;smArta-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;shukla&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;smArta-vaikuNTha-EkAdazI&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;smArta-guruvAyupura-EkAdazI&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;vaiSNava-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;shukla&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vaiSNava-vaikuNTha-EkAdazI&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vaiSNava-guruvAyupura-EkAdazI&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;sarva-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;shukla&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sarva-vaikuNTha-EkAdazI&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sarva-guruvAyupura-EkAdazI&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">11</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;sarva-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;shukla&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sarva-vaikuNTha-EkAdazI&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sarva-guruvAyupura-EkAdazI&#39;</span><span class="p">)</span>

                <span class="c1"># Harivasara Computation</span>
                <span class="n">harivasara_end</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI_PADA</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                <span class="p">[</span><span class="n">_y</span><span class="p">,</span> <span class="n">_m</span><span class="p">,</span> <span class="n">_d</span><span class="p">,</span> <span class="n">_t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">harivasara_end</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))</span>
                <span class="n">hariv_end_time</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">harivasara_end</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>

                <span class="n">fday</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">julday</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">_m</span><span class="p">,</span> <span class="n">_d</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">fday</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s1">&#39;harivAsaraH-</span><span class="se">\\</span><span class="s1">textsf{</span><span class="si">%s</span><span class="s1">}{</span><span class="se">\\</span><span class="s1">RIGHTarrow}</span><span class="se">\\</span><span class="s1">textsf{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">hariv_end_time</span><span class="p">))</span>

            <span class="c1"># One of two consecutive tithis must appear @ sunrise!</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">26</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
                <span class="c1"># check for krishna ekadashi</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">26</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">26</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;sarva-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;krishna&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">26</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">26</span><span class="p">):</span>
                    <span class="c1"># Check dashami end time to decide for whether this is</span>
                    <span class="c1"># sarva/smartha</span>
                    <span class="c1"># Two muhurtams is 1/15 of day-length</span>
                    <span class="n">tithi_arunodayam</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">15.0</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tithi_arunodayam</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;smArta-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;krishna&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;vaiSNava-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;krishna&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s1">&#39;sarva-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;krishna&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">26</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;sarva-&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_ekadashi_name</span><span class="p">(</span><span class="s1">&#39;krishna&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>

                <span class="n">harivasara_end</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI_PADA</span><span class="p">,</span> <span class="o">-</span><span class="mi">105</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                <span class="p">[</span><span class="n">_y</span><span class="p">,</span> <span class="n">_m</span><span class="p">,</span> <span class="n">_d</span><span class="p">,</span> <span class="n">_t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">harivasara_end</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))</span>
                <span class="n">hariv_end_time</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">harivasara_end</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>

                <span class="n">fday</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">julday</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">_m</span><span class="p">,</span> <span class="n">_d</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">fday</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s1">&#39;harivAsaraH-</span><span class="se">\\</span><span class="s1">textsf{</span><span class="si">%s</span><span class="s1">}{</span><span class="se">\\</span><span class="s1">RIGHTarrow}</span><span class="se">\\</span><span class="s1">textsf{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">hariv_end_time</span><span class="p">))</span>

            <span class="c1"># PRADOSHA Vratam</span>
            <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                <span class="n">tithi_sunset</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="n">tithi_sunset_tmrw</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tithi_sunset</span> <span class="o">&lt;=</span> <span class="mi">13</span> <span class="ow">and</span> <span class="n">tithi_sunset_tmrw</span> <span class="o">!=</span> <span class="mi">13</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;sOma-&#39;</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;zani-&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;pradOSa-vratam&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tithi_sunset_tmrw</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;sOma-&#39;</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;zani-&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;pradOSa-vratam&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
                <span class="n">tithi_sunset</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="n">tithi_sunset_tmrw</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tithi_sunset</span> <span class="o">&lt;=</span> <span class="mi">28</span> <span class="ow">and</span> <span class="n">tithi_sunset_tmrw</span> <span class="o">!=</span> <span class="mi">28</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;sOma-&#39;</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;zani-&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;pradOSa-vratam&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tithi_sunset_tmrw</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;sOma-&#39;</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;zani-&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;pradOSa-vratam&#39;</span><span class="p">)</span>

            <span class="c1"># SANKATAHARA chaturthi</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">18</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>
                <span class="n">ldiff_moonrise_yest</span> <span class="o">=</span> <span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                       <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
                <span class="n">ldiff_moonrise</span> <span class="o">=</span> <span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                  <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
                <span class="n">ldiff_moonrise_tmrw</span> <span class="o">=</span> <span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                       <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_moonrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
                <span class="n">tithi_moonrise_yest</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">ldiff_moonrise_yest</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
                <span class="n">tithi_moonrise</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">ldiff_moonrise</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
                <span class="n">tithi_moonrise_tmrw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">ldiff_moonrise_tmrw</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">tithi_moonrise</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>
                    <span class="c1"># otherwise yesterday would have already been assigned</span>
                    <span class="k">if</span> <span class="n">tithi_moonrise_yest</span> <span class="o">!=</span> <span class="mi">19</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;saGkaTahara-caturthI-vratam&#39;</span><span class="p">)</span>
                        <span class="c1"># shravana krishna chaturthi</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mahA&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">tithi_moonrise_tmrw</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;saGkaTahara-caturthI-vratam&#39;</span><span class="p">)</span>
                    <span class="c1"># self.lunar_month[d] and[d + 1] are same, so checking [d] is enough</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mahA&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tithi_moonrise_yest</span> <span class="o">!=</span> <span class="mi">19</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tithi_moonrise</span> <span class="o">==</span> <span class="mi">18</span> <span class="ow">and</span> <span class="n">tithi_moonrise_tmrw</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;saGkaTahara-caturthI-vratam&#39;</span><span class="p">)</span>
                            <span class="c1"># shravana krishna chaturthi</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mahA&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># SHASHTHI Vratam</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span>\
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span><span class="p">):</span>
                    <span class="c1"># otherwise yesterday would have already been assigned</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SaSThI-vratam&#39;</span><span class="p">)</span>
                        <span class="c1"># kArtika shukla shashthi</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;skanda&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kumAra-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SaSThIdEvI-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;subrahmaNya-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SaSThI-vratam&#39;</span><span class="p">)</span>
                    <span class="c1"># self.lunar_month[d] and[d + 1] are same, so checking [d] is enough</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;skanda&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kumAra-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SaSThIdEvI-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;subrahmaNya-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Chandra Darshanam</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tithi_sunset</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="n">tithi_sunset_tmrw</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tithi_sunset</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">tithi_sunset_tmrw</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tithi_sunset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;candra-darzanam&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;candra-darzanam&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tithi_sunset_tmrw</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;candra-darzanam&#39;</span><span class="p">)</span>

            <span class="c1"># Amavasya Tarpanam</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Reset (at start) every month, as one of these two tithis must hit sunrise!</span>
                <span class="n">t29_end</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">t30_end</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">29</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">29</span><span class="p">:</span>
                    <span class="n">t29</span><span class="p">,</span> <span class="n">t29_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">t30</span><span class="p">,</span> <span class="n">t30_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">t30</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
                        <span class="c1"># Only 29 ends tomorrow!</span>
                        <span class="n">t30</span><span class="p">,</span> <span class="n">t30_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t29_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># 29 never touched sunrise</span>
                        <span class="n">t30</span><span class="p">,</span> <span class="n">t30_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">t29</span><span class="p">,</span> <span class="n">t29_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_data</span><span class="p">(</span><span class="n">t30_end</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">t30_end</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
                                                                                   <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">t29_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Should never be here!</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Error! Still not computed t29_end!&#39;</span><span class="p">)</span>

                <span class="n">angams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_angams_for_kalas</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span><span class="p">,</span> <span class="s1">&#39;aparahna&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">) mahAlaya &#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_chandra_masa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                          <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">,</span> <span class="s1">&#39;hk&#39;</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (kaTaka) &#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_chandra_masa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                          <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">,</span> <span class="s1">&#39;hk&#39;</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;mauni (</span><span class="si">%s</span><span class="s1">/makara) &#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_chandra_masa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                          <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">,</span> <span class="s1">&#39;hk&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pref</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_chandra_masa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                             <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">,</span> <span class="s1">&#39;hk&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span>
                    <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                        <span class="c1"># Amavasya is there on both aparahnas</span>
                        <span class="k">if</span> <span class="n">t30_end</span> <span class="o">-</span> <span class="n">t29_end</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># But not longer than 60 ghatikas</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;amAvasyA&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># And longer than 60 ghatikas</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;amAvasyA&#39;</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># No Amavasya in aparahna tomorrow, so it&#39;s today</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="s1">&#39;amAvasyA&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># MAKARAYANAM</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">makara_jd_start</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_nirayana_sun_lon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="mi">15</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">270</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">and</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">makara_jd_start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;makarAyaNa-puNyakAlam/mitrOtsavam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># KUCHELA DINAM</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;kucEla-dinam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="c1"># AGNI NAKSHATRAM</span>
            <span class="c1"># Arbitrarily checking after Mesha 10! Agni Nakshatram can&#39;t start earlier...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">agni_jd_start</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;arc_len&#39;</span><span class="p">:</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="mf">108.0</span><span class="p">,</span> <span class="s1">&#39;w_moon&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;w_sun&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="mi">7</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="c1"># sys.stderr.write(&#39;Agni Start: %s\n&#39; % revjul(agni_jd_start + (5.5 / 24.0)))</span>
                <span class="n">dummy</span><span class="p">,</span> <span class="n">agni_jd_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                    <span class="n">agni_jd_start</span><span class="p">,</span> <span class="n">agni_jd_start</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;arc_len&#39;</span><span class="p">:</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="mf">108.0</span><span class="p">,</span> <span class="s1">&#39;w_moon&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;w_sun&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="mi">13</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="c1"># sys.stderr.write(&#39;Agni End: %s\n&#39; % revjul(agni_jd_end + (5.5 / 24.0)))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">agni_jd_start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;agninakSatram-ArambhaH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">agni_jd_end</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;agninakSatram-samApanam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># GAJACHHAYA YOGA</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">moon_magha_jd_start</span> <span class="o">=</span> <span class="n">moon_magha_jd_start</span> <span class="o">=</span> <span class="n">t28_start</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">moon_magha_jd_end</span> <span class="o">=</span> <span class="n">moon_magha_jd_end</span> <span class="o">=</span> <span class="n">t28_end</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">moon_hasta_jd_start</span> <span class="o">=</span> <span class="n">moon_hasta_jd_start</span> <span class="o">=</span> <span class="n">t30_start</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">moon_hasta_jd_end</span> <span class="o">=</span> <span class="n">moon_hasta_jd_end</span> <span class="o">=</span> <span class="n">t30_end</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">sun_hasta_jd_start</span><span class="p">,</span> <span class="n">sun_hasta_jd_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">SOLAR_NAKSH</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>

                <span class="n">moon_magha_jd_start</span><span class="p">,</span> <span class="n">moon_magha_jd_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                    <span class="n">sun_hasta_jd_start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sun_hasta_jd_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">moon_magha_jd_start</span><span class="p">,</span> <span class="n">moon_magha_jd_end</span><span class="p">]):</span>
                    <span class="n">t28_start</span><span class="p">,</span> <span class="n">t28_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                        <span class="n">moon_magha_jd_start</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">moon_magha_jd_end</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>

                <span class="n">moon_hasta_jd_start</span><span class="p">,</span> <span class="n">moon_hasta_jd_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                    <span class="n">sun_hasta_jd_start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sun_hasta_jd_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">moon_hasta_jd_start</span><span class="p">,</span> <span class="n">moon_hasta_jd_end</span><span class="p">]):</span>
                    <span class="n">t30_start</span><span class="p">,</span> <span class="n">t30_end</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_span</span><span class="p">(</span>
                        <span class="n">sun_hasta_jd_start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sun_hasta_jd_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span>

                <span class="n">gc_28</span> <span class="o">=</span> <span class="n">gc_30</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">sun_hasta_jd_start</span><span class="p">,</span> <span class="n">moon_magha_jd_start</span><span class="p">,</span> <span class="n">t28_start</span><span class="p">]):</span>
                    <span class="c1"># We have a GC yoga</span>
                    <span class="n">gc_28_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sun_hasta_jd_start</span><span class="p">,</span> <span class="n">moon_magha_jd_start</span><span class="p">,</span> <span class="n">t28_start</span><span class="p">)</span>
                    <span class="n">gc_28_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sun_hasta_jd_end</span><span class="p">,</span> <span class="n">moon_magha_jd_end</span><span class="p">,</span> <span class="n">t28_end</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">gc_28_start</span> <span class="o">&lt;</span> <span class="n">gc_28_end</span><span class="p">:</span>
                        <span class="n">gc_28</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">sun_hasta_jd_start</span><span class="p">,</span> <span class="n">moon_hasta_jd_start</span><span class="p">,</span> <span class="n">t30_start</span><span class="p">]):</span>
                    <span class="c1"># We have a GC yoga</span>
                    <span class="n">gc_30_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sun_hasta_jd_start</span><span class="p">,</span> <span class="n">moon_hasta_jd_start</span><span class="p">,</span> <span class="n">t30_start</span><span class="p">)</span>
                    <span class="n">gc_30_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sun_hasta_jd_end</span><span class="p">,</span> <span class="n">moon_hasta_jd_end</span><span class="p">,</span> <span class="n">t30_end</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">gc_30_start</span> <span class="o">&lt;</span> <span class="n">gc_30_end</span><span class="p">:</span>
                        <span class="n">gc_30</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="p">(</span><span class="n">gc_28</span> <span class="ow">or</span> <span class="n">gc_30</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">gc_28</span><span class="p">:</span>
                    <span class="n">gc_28_start</span> <span class="o">+=</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="n">gc_28_end</span> <span class="o">+=</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="c1"># sys.stderr.write(&#39;28: (%f, %f)\n&#39; % (gc_28_start, gc_28_end))</span>
                    <span class="n">gc_28_d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">gc_28_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span><span class="p">)</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">gc_28_start</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">floor</span><span class="p">(</span><span class="n">gc_28_end</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">floor</span><span class="p">(</span><span class="n">gc_28_start</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">):</span>
                        <span class="c1"># -0.5 is for the fact that julday is zero at noon always, not midnight!</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">24</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">t2</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">gc_28_end</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>
                    <span class="c1"># sys.stderr.write(&#39;gajacchhaya %d\n&#39; % gc_28_d)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;gajacchAyA-yOgaH&#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;-</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span> <span class="n">t1</span> <span class="o">+</span> <span class="s1">&#39;}{</span><span class="se">\\</span><span class="s1">RIGHTarrow}</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span>
                                   <span class="n">t2</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">gc_28_d</span><span class="p">]</span>
                    <span class="n">gc_28</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">gc_30</span><span class="p">:</span>
                    <span class="n">gc_30_start</span> <span class="o">+=</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="n">gc_30_end</span> <span class="o">+=</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="c1"># sys.stderr.write(&#39;30: (%f, %f)\n&#39; % (gc_30_start, gc_30_end))</span>
                    <span class="n">gc_30_d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">gc_30_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span><span class="p">)</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">gc_30_start</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">floor</span><span class="p">(</span><span class="n">gc_30_end</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">floor</span><span class="p">(</span><span class="n">gc_30_start</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">):</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">24</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">t2</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">gc_30_end</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>
                    <span class="c1"># sys.stderr.write(&#39;gajacchhaya %d\n&#39; % gc_30_d)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;gajacchAyA-yOgaH&#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;-</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span> <span class="n">t1</span> <span class="o">+</span> <span class="s1">&#39;}{</span><span class="se">\\</span><span class="s1">RIGHTarrow}</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span>
                                   <span class="n">t2</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">gc_30_d</span><span class="p">]</span>
                    <span class="n">gc_30</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># AYUSHMAN BAVA SAUMYA</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                               <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">YOGAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">KARANAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">7</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;AyuSmAn-bava-saumya&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># VYATIPATAM</span>
            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">YOGAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;mahAdhanurvyatIpAtam&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">YOGAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;mahAvyatIpAtam&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>


            <span class="c1"># 8 MAHA DWADASHIS</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;unmIlanI-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;vyaJjulI-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;trispRzA-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;pakSavardhinI-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span>\
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;pApanAzinI-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">and</span>\
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;jayantI-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span>\
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;jayA-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">22</span> <span class="ow">and</span>\
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;vijayA/zravaNa-mahAdvAdazI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>


            <span class="c1"># SPECIAL SAPTAMIs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;bhAnusaptamI&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;vijayA&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">festival_name</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
                    <span class="c1"># Even more auspicious!</span>
                    <span class="n">festival_name</span> <span class="o">+=</span> <span class="s1">&#39;*&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRA_PADA</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">49</span> <span class="ow">and</span>\
               <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;bhadrA-saptamI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;RIGHTarrow&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># we have a Sankranti!</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;mahAjayA-saptamI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># VARUNI TRAYODASHI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
                    <span class="n">vtr_name</span> <span class="o">=</span> <span class="s1">&#39;vAruNI-trayOdazI&#39;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">vtr_name</span> <span class="o">=</span> <span class="s1">&#39;mahA&#39;</span> <span class="o">+</span> <span class="n">vtr_name</span>
                        <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                  <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">YOGAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span>
                            <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;mahA&#39;</span> <span class="o">+</span> <span class="n">vtr_name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">vtr_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>


            <span class="c1"># SOMAMAVASYA</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;sOma-amAvasyA&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># MAHODAYAM</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">YOGAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">and</span>\
                   <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAKSHATRAM</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;mahOdaya-puNyakAlaH&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;ardhOdaya-puNyakAlaH&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># MANGALA-CHATURTHI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;aGgAraka-caturthI&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;sukhA&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">festival_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># KRISHNA ANGARAKA CHATURDASHI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">29</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;kRSNAGgAraka-caturdazI-puNyakAlam/yamatarpaNam&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>
                <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;budhASTamI&#39;</span>

            <span class="c1"># BUDHASHTAMI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;budhASTamI&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>
                <span class="n">festival_name</span> <span class="o">=</span> <span class="s1">&#39;budhASTamI&#39;</span>

            <span class="c1"># AVANI NYAYITRUKIZHAMAI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:AvaNi-JAyir2r2ukkizhamai&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># PURATTASI SANIKKIZHAMAI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:puraTTAci can2ikkizhamai&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># KARTHIKAI NYAYITRUKIZHAMAI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:kArttigai-JAyir2r2ukkizhamai&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># KRTTIKA SOMAVASARA</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:kArttigai-sOmavAram&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># AADI VELLI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:ADi-veLLikkizhamai&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># TAI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:tai-veLLikkizhamai&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># MASI SEVVAI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;ta:mAci-cevvAy&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># BHAUMASHWINI</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>\
               <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Is it necessarily only at sunrise?</span>
                <span class="c1"># angams = self.get_angams_for_kalas(d, helper_functions.get_nakshatram, &#39;madhyahna&#39;)</span>
                <span class="c1"># if any(x == 1 for x in [self.nakshatram_sunrise[d], angams[0], angams[1]]):</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;bhaumAzvinI-puNyakAlaH&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># BUDHANURADHA</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">17</span><span class="p">)</span>\
               <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Is it necessarily only at sunrise?</span>
                <span class="c1"># angams = self.get_angams_for_kalas(d, helper_functions.get_nakshatram, &#39;madhyahna&#39;)</span>
                <span class="c1"># if any(x == 17 for x in [self.nakshatram_sunrise[d], angams[0], angams[1]]):</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">17</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="s1">&#39;budhAnUrAdhA-puNyakAlaH&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CODE_ROOT</span><span class="p">,</span> <span class="s1">&#39;panchangam/data/festival_rules.json&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">festivals_data</span><span class="p">:</span>
                <span class="n">festival_rules</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">festivals_data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">festival_name</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;Month Type&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">month_type</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;Month Type&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Maybe only description of the festival is given, as computation has been</span>
                    <span class="c1"># done in computeFestivals(), without using a rule in festival_rules.json!</span>
                    <span class="k">if</span> <span class="s1">&#39;Short Description&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                        <span class="k">continue</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;No month_type mentioned for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">festival_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;Month Number&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">month_num</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;Month Number&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;No month_num mentioned for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">festival_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;Angam Type&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">angam_type</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;Angam Type&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;No angam_type mentioned for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">festival_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;Angam Number&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">angam_num</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;Angam Number&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;No angam_num mentioned for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">festival_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;kala&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">kala</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;kala&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kala</span> <span class="o">=</span> <span class="s1">&#39;sunrise&#39;</span>  <span class="c1"># default!</span>
                <span class="k">if</span> <span class="s1">&#39;priority&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">priority</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">priority</span> <span class="o">=</span> <span class="s1">&#39;purvaviddha&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;Start Year&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]:</span>
                    <span class="n">fest_start_year</span> <span class="o">=</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;Start Year&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fest_start_year</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># if &#39;Other Names&#39; in festival_rules[festival_name]:</span>
                <span class="c1">#     fest_other_names = festival_rules[festival_name][&#39;Other Names&#39;]</span>
                <span class="c1"># if &#39;Nirnaya&#39; in festival_rules[festival_name]:</span>
                <span class="c1">#     fest_nirnaya = festival_rules[festival_name][&#39;Nirnaya&#39;]</span>
                <span class="c1"># if &#39;Primary Reference&#39; in festival_rules[festival_name]:</span>
                <span class="c1">#     fest_ref1 = festival_rules[festival_name][&#39;Primary Reference&#39;]</span>
                <span class="c1"># if &#39;Secondary Reference&#39; in festival_rules[festival_name]:</span>
                <span class="c1">#     fest_ref2 = festival_rules[festival_name][&#39;Secondary Reference&#39;]</span>
                <span class="c1"># if &#39;Comments&#39; in festival_rules[festival_name]:</span>
                <span class="c1">#     fest_comments = festival_rules[festival_name][&#39;Comments&#39;]</span>

                <span class="k">if</span> <span class="n">angam_type</span> <span class="o">==</span> <span class="s1">&#39;tithi&#39;</span> <span class="ow">and</span> <span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;lunar_month&#39;</span> <span class="ow">and</span>\
                   <span class="n">angam_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Shukla prathama tithis need to be dealt carefully, if e.g. the prathama tithi</span>
                    <span class="c1"># does not touch sunrise on either day (the regular check won&#39;t work, because</span>
                    <span class="c1"># the month itself is different the previous day!)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>\
                       <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">month_num</span><span class="p">:</span>
                        <span class="c1"># Only in this case, we have a problem</span>
                        <span class="n">fest_num</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">fest_start_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;lunar_month&#39;</span><span class="p">:</span>
                                <span class="n">fest_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">3100</span> <span class="o">+</span>\
                                    <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">fest_start_year</span> <span class="o">+</span> <span class="mi">1</span>

                        <span class="k">if</span> <span class="n">fest_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fest_num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Festival </span><span class="si">%s</span><span class="s1"> is only in the future!</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                             <span class="n">festival_name</span><span class="p">)</span>
                            <span class="k">return</span>

                        <span class="k">if</span> <span class="n">fest_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">festival_name</span> <span class="o">+=</span> <span class="s1">&#39;-</span><span class="se">\\</span><span class="s1">#{</span><span class="si">%d</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">fest_num</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="k">if</span> <span class="n">angam_type</span> <span class="o">==</span> <span class="s1">&#39;day&#39;</span> <span class="ow">and</span> <span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;solar_month&#39;</span>\
                   <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="n">month_num</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month_day</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;lunar_month&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="n">month_num</span><span class="p">)</span> <span class="ow">or</span>\
                     <span class="p">(</span><span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;solar_month&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="n">month_num</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">angam_type</span> <span class="o">==</span> <span class="s1">&#39;tithi&#39;</span><span class="p">:</span>
                        <span class="n">angam_sunrise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tithi_sunrise</span>
                        <span class="n">get_angam_func</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_tithi</span>
                    <span class="k">elif</span> <span class="n">angam_type</span> <span class="o">==</span> <span class="s1">&#39;nakshatram&#39;</span><span class="p">:</span>
                        <span class="n">angam_sunrise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nakshatram_sunrise</span>
                        <span class="n">get_angam_func</span> <span class="o">=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_nakshatram</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error; unknown string in rule: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">angam_type</span><span class="p">))</span>
                        <span class="k">return</span>

                    <span class="n">fday</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">fest_num</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">fest_start_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">month_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;solar_month&#39;</span><span class="p">:</span>
                            <span class="n">fest_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">3100</span> <span class="o">+</span>\
                                <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">fest_start_year</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">month_type</span> <span class="o">==</span> <span class="s1">&#39;lunar_month&#39;</span><span class="p">:</span>
                            <span class="n">fest_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">3100</span> <span class="o">+</span>\
                                <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">fest_start_year</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">fest_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fest_num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Festival </span><span class="si">%s</span><span class="s1"> is only in the future!</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">festival_name</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="k">if</span> <span class="n">fest_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">festival_name</span> <span class="o">+=</span> <span class="s1">&#39;-</span><span class="se">\\</span><span class="s1">#{</span><span class="si">%d</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">fest_num</span>

                    <span class="k">if</span> <span class="n">angam_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">angam_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span><span class="p">:</span>
                        <span class="n">angams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_angams_for_kalas</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">get_angam_func</span><span class="p">,</span> <span class="n">kala</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">angams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;No angams returned! Skipping festival </span><span class="si">%s</span><span class="s1">&#39;</span>
                                             <span class="o">%</span> <span class="n">festival_name</span><span class="p">)</span>
                            <span class="k">continue</span>
                            <span class="c1"># Some error, e.g. weird kala, so skip festival</span>
                        <span class="k">if</span> <span class="n">debugFestivals</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;%&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">festival_name</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">])</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">angams today &amp; tmrw:&quot;</span><span class="p">,</span> <span class="n">angams</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">festival_name</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span>
                                      <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">angams today &amp; tmrw:&quot;</span><span class="p">,</span> <span class="n">angams</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="s1">&#39;paraviddha&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span><span class="p">:</span>
                                <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span>
                            <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span><span class="p">:</span>
                                <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span>

                            <span class="k">if</span> <span class="n">fday</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">festival_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">:</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">angams</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                                        <span class="c1"># This can fail for &quot;boundary&quot; angam_nums like 1 and 30!</span>
                                        <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span>  <span class="c1"># Should be d - 1?</span>
                                        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Assigned paraviddha day for </span><span class="si">%s</span><span class="s1"> as </span><span class="si">%d</span><span class="s1"> with difficulty!&#39;</span> <span class="o">%</span>
                                                         <span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">fday</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Please check for unusual cases.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">fday</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">debugFestivals</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">angams</span><span class="p">,</span> <span class="n">angam_num</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">festival_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">:</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Could not assign paraviddha day for </span><span class="si">%s</span><span class="s1">!&#39;</span> <span class="o">%</span>
                                                     <span class="n">festival_name</span> <span class="o">+</span>
                                                     <span class="s1">&#39; Please check for unusual cases.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="c1"># else:</span>
                            <span class="c1">#     sys.stderr.write(&#39;Assigned paraviddha day for %s!&#39; %</span>
                            <span class="c1">#                      festival_name + &#39; Ignore future warnings!\n&#39;)</span>
                        <span class="k">elif</span> <span class="n">priority</span> <span class="o">==</span> <span class="s1">&#39;purvaviddha&#39;</span><span class="p">:</span>
                            <span class="n">angams_yest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_angams_for_kalas</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">get_angam_func</span><span class="p">,</span> <span class="n">kala</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">debugFestivals</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;%angams yest &amp; today:&quot;</span><span class="p">,</span> <span class="n">angams_yest</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">festival_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">:</span>
                                    <span class="c1"># Check if yesterday was assigned already</span>
                                    <span class="c1"># to this purvaviddha festival!</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span>
                            <span class="k">elif</span> <span class="n">angams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span><span class="p">:</span>
                                <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">fday</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="c1"># This means that the correct angam did not</span>
                                <span class="c1"># touch the kalam on either day!</span>
                                <span class="c1"># sys.stderr.write(&#39;Could not assign purvaviddha day for %s!\</span>
                                <span class="c1"># Please check for unusual cases.\n&#39; % festival_name)</span>
                                <span class="k">if</span> <span class="n">angams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">angams</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">angam_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="c1"># Need to assign a day to the festival here</span>
                                    <span class="c1"># since the angam did not touch kalam on either day</span>
                                    <span class="c1"># BUT ONLY IF YESTERDAY WASN&#39;T ALREADY ASSIGNED,</span>
                                    <span class="c1"># THIS BEING PURVAVIDDHA</span>
                                    <span class="c1"># Perhaps just need better checking of</span>
                                    <span class="c1"># conditions instead of this fix</span>
                                    <span class="k">if</span> <span class="n">festival_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">fday</span> <span class="o">=</span> <span class="n">d</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Unknown priority &quot;</span><span class="si">%s</span><span class="s1">&quot; for </span><span class="si">%s</span><span class="s1">! Check the rules!&#39;</span> <span class="o">%</span>
                                             <span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">festival_name</span><span class="p">))</span>
                    <span class="c1"># print (self.fest_days)</span>
                    <span class="k">if</span> <span class="n">fday</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">festival_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span>\
                           <span class="s1">&#39;kala&#39;</span> <span class="ow">in</span> <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">]</span> <span class="ow">and</span>\
                           <span class="n">festival_rules</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="s1">&#39;kala&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;arunodaya&#39;</span><span class="p">:</span>
                            <span class="n">fday</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addFestival</span><span class="p">(</span><span class="n">festival_name</span><span class="p">,</span> <span class="n">fday</span><span class="p">,</span> <span class="n">debugFestivals</span><span class="p">)</span>

            <span class="c1"># distance from prabhava</span>
            <span class="n">samvatsara_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1568</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">new_yr</span> <span class="o">=</span> <span class="s1">&#39;mESa-saGkrAnti&#39;</span> <span class="o">+</span> <span class="s1">&#39;-(&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">NAMES</span><span class="p">[</span><span class="s1">&#39;YEAR&#39;</span><span class="p">][</span><span class="s1">&#39;hk&#39;</span><span class="p">][(</span><span class="n">samvatsara_id</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>\
                     <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;saMvatsaraH&#39;</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">new_yr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>

        <span class="c1"># If tripurotsava coincides with maha kArtikI (kRttikA nakShatram)</span>
        <span class="c1"># only then it is mahAkArtikI</span>
        <span class="c1"># else it is only tripurotsava</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;tripurOtsavaH&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;mahA-kArtikI&#39;</span><span class="p">]:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;mahA-kArtikI&#39;</span><span class="p">]</span>
            <span class="c1"># An error here implies the festivals were not assigned: adhika</span>
            <span class="c1"># mAsa calc errors??</span>

        <span class="c1"># Add &quot;RELATIVE&quot; festivals --- festivals that happen before or</span>
        <span class="c1"># after other festivals with an exact timedelta!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;gAyatrI-japaH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;yajurvEda-upAkarma&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;varalakSmI-vratam&#39;</span><span class="p">]</span> <span class="o">=</span>\
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;yajurvEda-upAkarma&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
             <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">weekday_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;yajurvEda-upAkarma&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;bhOgI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;makara-saGkrAnti/uttarAyaNa-puNyakAlaH&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;hOli&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;hOlikA-pUrNimA&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;indra-pUjA/gO-pUjA&#39;</span><span class="p">]</span> <span class="o">=</span>\
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;makara-saGkrAnti/uttarAyaNa-puNyakAlaH&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kan2up-poGgal&#39;</span><span class="p">]</span> <span class="o">=</span>\
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;makara-saGkrAnti/uttarAyaNa-puNyakAlaH&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;mahAlaya-pakSam-samApanam&#39;</span><span class="p">]</span> <span class="o">=</span>\
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;(bhAdrapada) mahAlaya amAvasyA&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># KAPALI FESTIVALS</span>
        <span class="n">panguni_uttaram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:paGgun2i-uttiram&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI dvajArOhaNam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">9</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI sUrya-candra-vaTTam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">8</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI adhikAra nandi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">7</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI bhUtaN bhUtakI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">7</span><span class="p">]</span>
        <span class="c1"># self.fest_days[&#39;ta:kapAlI veLLi bhUta vAhan2am&#39;] = [panguni_uttaram - 6]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI cavuDal vimAn2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI riSabha vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI pallakku vizhA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI tEr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI ar2upattu mUvar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c1"># self.fest_days[&#39;ta:kapAlI bhikSATan2ar&#39;] = [panguni_uttaram - 1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI umA-mahezvara darican2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI viDaiyAr2r2i toDakkam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI viDaiyAr2r2i nir2aivu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">panguni_uttaram</span> <span class="o">+</span> <span class="mi">11</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:kapAlI teppOtsavam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:taippUcam&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:taippUcam&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:taippUcam&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># CHIDAMBARAM FESTIVALS</span>
        <span class="n">aani_tirumanjanam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:naTarAjar An2i tirumaJcan2am&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram dvajArOhaNam/paJcamUrtti bhavan2i&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">9</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram veLLi candraprabha vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">8</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram taGga sUryaprabha vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">7</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram veLLi bhUta vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">6</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram veLLi riSabha vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram veLLi yAn2ai vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram kailAca vAhan2am&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram bhikSATan2ar taGga ratham&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram tEr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="s1">&#39;ta:cidambaram muttuppallakku&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aani_tirumanjanam</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">debugFestivals</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">festival_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fest_days</span><span class="p">[</span><span class="n">festival_name</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">festival_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Panchangam.computeSolarEclipses"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.computeSolarEclipses">[docs]</a>    <span class="k">def</span> <span class="nf">computeSolarEclipses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Set location</span>
        <span class="n">swe</span><span class="o">.</span><span class="n">set_topo</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">alt</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">jd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">next_eclipse_sol</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">sol_eclipse_when_loc</span><span class="p">(</span>
                <span class="n">julday</span><span class="o">=</span><span class="n">jd</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
            <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">next_eclipse_sol</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">local_time</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span>
                <span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c1"># checking @ 6am local - can we do any better?</span>
            <span class="n">tz_off</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span>
                      <span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span>
            <span class="c1"># compute offset from UTC</span>
            <span class="n">jd</span> <span class="o">=</span> <span class="n">next_eclipse_sol</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
            <span class="n">jd_eclipse_solar_start</span> <span class="o">=</span> <span class="n">next_eclipse_sol</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
            <span class="n">jd_eclipse_solar_end</span> <span class="o">=</span> <span class="n">next_eclipse_sol</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
            <span class="c1"># -1 is to not miss an eclipse that occurs after sunset on 31-Dec!</span>
            <span class="n">eclipse_y</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">eclipse_y</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fday</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span> <span class="o">-</span> <span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">jd</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span> <span class="o">+</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)):</span>
                    <span class="n">fday</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">eclipse_solar_start</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span>
                    <span class="n">jd_eclipse_solar_start</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">eclipse_solar_end</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd_eclipse_solar_end</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">jd_eclipse_solar_start</span> <span class="o">-</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span>\
                   <span class="p">(</span><span class="n">jd_eclipse_solar_end</span> <span class="o">-</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1"># Move towards the next eclipse... at least the next new</span>
                    <span class="c1"># moon (&gt;=25 days away)</span>
                    <span class="n">jd</span> <span class="o">+=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MIN_DAYS_NEXT_ECLIPSE</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">eclipse_solar_end</span> <span class="o">&lt;</span> <span class="n">eclipse_solar_start</span><span class="p">:</span>
                    <span class="n">eclipse_solar_end</span> <span class="o">+=</span> <span class="mi">24</span>
                <span class="n">sunrise_eclipse_day</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">sunset_eclipse_day</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">eclipse_solar_start</span> <span class="o">&lt;</span> <span class="n">sunrise_eclipse_day</span><span class="p">:</span>
                    <span class="n">eclipse_solar_start</span> <span class="o">=</span> <span class="n">sunrise_eclipse_day</span>
                <span class="k">if</span> <span class="n">eclipse_solar_end</span> <span class="o">&gt;</span> <span class="n">sunset_eclipse_day</span><span class="p">:</span>
                    <span class="n">eclipse_solar_end</span> <span class="o">=</span> <span class="n">sunset_eclipse_day</span>
                <span class="n">solar_eclipse_str</span> <span class="o">=</span> <span class="s1">&#39;sUrya-grahaNam&#39;</span> <span class="o">+</span>\
                    <span class="s1">&#39;-</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">eclipse_solar_start</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="o">+</span>\
                    <span class="s1">&#39;}{</span><span class="se">\\</span><span class="s1">RIGHTarrow}</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">eclipse_solar_end</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">solar_eclipse_str</span> <span class="o">=</span> <span class="s1">&#39;*cUDAmaNi-&#39;</span> <span class="o">+</span> <span class="n">solar_eclipse_str</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solar_eclipse_str</span><span class="p">)</span>
            <span class="n">jd</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MIN_DAYS_NEXT_ECLIPSE</span></div>

<div class="viewcode-block" id="Panchangam.computeLunarEclipses"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.computeLunarEclipses">[docs]</a>    <span class="k">def</span> <span class="nf">computeLunarEclipses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Set location</span>
        <span class="n">swe</span><span class="o">.</span><span class="n">set_topo</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">alt</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">jd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">next_eclipse_lun</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">lun_eclipse_when</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span>
            <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">next_eclipse_lun</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">local_time</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span>
                <span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c1"># checking @ 6am local - can we do any better? This is crucial,</span>
            <span class="c1"># since DST changes before 6 am</span>
            <span class="n">tz_off</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span>
                      <span class="n">datetime</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span>
            <span class="c1"># compute offset from UTC</span>
            <span class="n">jd</span> <span class="o">=</span> <span class="n">next_eclipse_lun</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
            <span class="n">jd_eclipse_lunar_start</span> <span class="o">=</span> <span class="n">next_eclipse_lun</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
            <span class="n">jd_eclipse_lunar_end</span> <span class="o">=</span> <span class="n">next_eclipse_lun</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
            <span class="c1"># -1 is to not miss an eclipse that occurs after sunset on 31-Dec!</span>
            <span class="n">eclipse_y</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">eclipse_y</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eclipse_lunar_start</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span>
                    <span class="n">jd_eclipse_lunar_start</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">eclipse_lunar_end</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd_eclipse_lunar_end</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">jd_eclipse_lunar_start</span> <span class="o">-</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span>\
                   <span class="p">(</span><span class="n">jd_eclipse_lunar_end</span> <span class="o">-</span> <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">))</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1"># Move towards the next eclipse... at least the next full</span>
                    <span class="c1"># moon (&gt;=25 days away)</span>
                    <span class="n">jd</span> <span class="o">+=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MIN_DAYS_NEXT_ECLIPSE</span>
                    <span class="k">continue</span>
                <span class="n">fday</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">floor</span><span class="p">(</span><span class="n">jd_eclipse_lunar_start</span><span class="p">)</span> <span class="o">-</span> <span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># print &#39;%%&#39;, jd, fday, self.jd_sunrise[fday],</span>
                <span class="c1"># self.jd_sunrise[fday-1]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">jd</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span> <span class="o">+</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)):</span>
                    <span class="n">fday</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">eclipse_lunar_start</span> <span class="o">&lt;</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">fday</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">eclipse_lunar_start</span> <span class="o">+=</span> <span class="mi">24</span>
                <span class="c1"># print &#39;%%&#39;, jd, fday, self.jd_sunrise[fday],</span>
                <span class="c1"># self.jd_sunrise[fday-1], eclipse_lunar_start,</span>
                <span class="c1"># eclipse_lunar_end</span>
                <span class="n">jd_moonrise_eclipse_day</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span>
                    <span class="n">jd_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">fday</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                    <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_RISE</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>\
                    <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>
                <span class="n">jd_moonset_eclipse_day</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">rise_trans</span><span class="p">(</span>
                    <span class="n">jd_start</span><span class="o">=</span><span class="n">jd_moonrise_eclipse_day</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">MOON</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                    <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">rsmi</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">CALC_SET</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">BIT_DISC_CENTER</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>\
                    <span class="p">(</span><span class="n">tz_off</span> <span class="o">/</span> <span class="mf">24.0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">eclipse_lunar_end</span> <span class="o">&lt;</span> <span class="n">eclipse_lunar_start</span><span class="p">:</span>
                    <span class="n">eclipse_lunar_end</span> <span class="o">+=</span> <span class="mi">24</span>

                <span class="k">if</span> <span class="n">jd_eclipse_lunar_end</span> <span class="o">&lt;</span> <span class="n">jd_moonrise_eclipse_day</span> <span class="ow">or</span>\
                   <span class="n">jd_eclipse_lunar_start</span> <span class="o">&gt;</span> <span class="n">jd_moonset_eclipse_day</span><span class="p">:</span>
                    <span class="c1"># Move towards the next eclipse... at least the next full</span>
                    <span class="c1"># moon (&gt;=25 days away)</span>
                    <span class="n">jd</span> <span class="o">+=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MIN_DAYS_NEXT_ECLIPSE</span>
                    <span class="k">continue</span>

                <span class="n">moonrise_eclipse_day</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd_moonrise_eclipse_day</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">moonset_eclipse_day</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd_moonset_eclipse_day</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">jd_eclipse_lunar_start</span> <span class="o">&lt;</span> <span class="n">jd_moonrise_eclipse_day</span><span class="p">:</span>
                    <span class="n">eclipse_lunar_start</span> <span class="o">=</span> <span class="n">moonrise_eclipse_day</span>
                <span class="k">if</span> <span class="n">jd_eclipse_lunar_end</span> <span class="o">&gt;</span> <span class="n">jd_moonset_eclipse_day</span><span class="p">:</span>
                    <span class="n">eclipse_lunar_end</span> <span class="o">=</span> <span class="n">moonset_eclipse_day</span>

                <span class="n">lunar_eclipse_str</span> <span class="o">=</span> <span class="s1">&#39;candra-grahaNam&#39;</span> <span class="o">+</span>\
                    <span class="s1">&#39;-</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">eclipse_lunar_start</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="o">+</span>\
                    <span class="s1">&#39;}{</span><span class="se">\\</span><span class="s1">RIGHTarrow}</span><span class="se">\\</span><span class="s1">textsf{&#39;</span> <span class="o">+</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">eclipse_lunar_end</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lunar_eclipse_str</span> <span class="o">=</span> <span class="s1">&#39;*cUDAmaNi-&#39;</span> <span class="o">+</span> <span class="n">lunar_eclipse_str</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">festivals</span><span class="p">[</span><span class="n">fday</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lunar_eclipse_str</span><span class="p">)</span>
            <span class="n">jd</span> <span class="o">+=</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MIN_DAYS_NEXT_ECLIPSE</span></div>

<div class="viewcode-block" id="Panchangam.writeDebugLog"><a class="viewcode-back" href="../../../jyotisha_panchangam_spatio_temporal.html#jyotisha.panchangam.spatio_temporal.Panchangam.writeDebugLog">[docs]</a>    <span class="k">def</span> <span class="nf">writeDebugLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cal-</span><span class="si">%4d</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-log.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1"># helper_functions.MAX_SZ = 368</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">MAX_SZ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">jd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">d</span>
            <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">revjul</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span>
            <span class="n">longitude_sun_sunset</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">swe</span><span class="o">.</span><span class="n">SUN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>\
                <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunset</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="n">log_data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%4d</span><span class="se">\t</span><span class="s1">[</span><span class="si">%3d</span><span class="s1">]</span><span class="se">\t</span><span class="s1">sun_rashi=</span><span class="si">%8.3f</span><span class="se">\t</span><span class="s1">tithi=</span><span class="si">%8.3f</span><span class="se">\t</span><span class="s1">solar_month</span><span class="se">\</span>
<span class="s1">        =</span><span class="si">%2d</span><span class="se">\t</span><span class="s1">lunar_month=</span><span class="si">%4.1f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">longitude_sun_sunset</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">,</span>
                                      <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">get_angam_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jd_sunrise</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                                                                   <span class="n">jyotisha</span><span class="o">.</span><span class="n">panchangam</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">TITHI</span><span class="p">,</span> <span class="n">ayanamsha_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ayanamsha_id</span><span class="p">),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">solar_month</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lunar_month</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span></div></div>




<span class="c1"># Essential for depickling to work.</span>
<span class="n">common</span><span class="o">.</span><span class="n">update_json_class_index</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">])</span>
<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">json_class_index</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">doctest</span>
  <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../jyotisha.html">jyotisha</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../jyotisha_panchangam.html">jyotisha.panchangam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jyotisha_names.html">jyotisha.names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jyotisha_custom_transliteration.html">jyotisha.custom_transliteration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../jyotisha.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, sanskrit-programmers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>